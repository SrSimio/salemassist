<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salem - Juego de Brujas</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Meta tags para PWA -->
    <meta name="theme-color" content="#16213e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Salem">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Iconos para diferentes dispositivos -->
    <link rel="icon" type="image/png" sizes="192x192" href="img/logo.png">
    <link rel="apple-touch-icon" href="img/logo.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Uncial+Antiqua&family=MedievalSharp&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Pantalla de carga -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="fire-animation">
                üî•
            </div>
            <div class="salem-title">SALEM</div>
            <div class="bottom-info">
                <div class="studio-brand">Una app de SimioStudio</div>
                <div class="copyright">¬© 2024 SimioStudio. Todos los derechos reservados.</div>
            </div>
        </div>
    </div>

    <!-- Men√∫ Principal -->
    <div id="main-menu" class="main-menu" style="display: none;">
        <div class="flames-bg"></div>
        
        <div class="menu-container">
            <header class="menu-header">
                <h1 class="main-title">üî• SALEM üî•</h1>
                <p class="subtitle">Los Juicios de las Brujas</p>
            </header>

            <div class="menu-options">
                <button id="new-game-btn" class="menu-btn btn-primary">
                    <span class="btn-icon">‚ö∞Ô∏è</span>
                    <span class="btn-text">Nuevo Juego</span>
                </button>
                
                <button id="rules-btn" class="menu-btn btn-secondary">
                    <span class="btn-icon">üìú</span>
                    <span class="btn-text">Reglas del Juego</span>
                </button>
            </div>

            <div class="menu-footer">
                <div class="studio-brand">Una app de SimioStudio</div>
                <div class="copyright">¬© 2024 SimioStudio. Todos los derechos reservados.</div>
            </div>
        </div>
    </div>

    <div class="container" id="main-app" style="display: none;">
        <!-- Fondo de llamas animadas -->
        <div class="flames-bg"></div>
        
        <!-- Header con t√≠tulo tem√°tico -->
        <header class="game-header">
            <h1 class="main-title">üî• SALEM üî•</h1>
            <p class="subtitle">Los Juicios de las Brujas</p>
            <button id="back-to-menu-btn" class="back-btn">
                <span>‚Üê Volver al Men√∫</span>
            </button>
        </header>

        <!-- Fase de configuraci√≥n -->
        <div id="setup-phase" class="game-phase active">
            <div class="phase-container">
                <h2 class="phase-title">‚ö∞Ô∏è Convoca a los Aldeanos ‚ö∞Ô∏è</h2>
                
                <div class="input-section">
                    <div class="input-group">
                        <input type="text" id="name-input" placeholder="Nombre del aldeano..." maxlength="20">
                        <button id="add-name-btn" class="btn btn-primary">
                            <span>üïØÔ∏è Invocar</span>
                        </button>
                    </div>
                </div>

                <div class="players-section">
                    <h3 class="section-title">üë• Aldeanos Convocados</h3>
                    <div id="names-list" class="names-grid"></div>
                    <div class="player-count">
                        <span id="player-count">0</span> / 12 aldeanos
                    </div>
                </div>

                <div class="timer-config-section">
                    <h3 class="section-title">‚è∞ Configuraci√≥n de Tiempo</h3>
                    <div class="timer-controls">
                        <div class="stage-timer-config">
                            <h4 class="config-subtitle">‚è±Ô∏è Timers de Etapas</h4>
                            <div class="checkbox-group">
                                <input type="checkbox" id="stage-timer-enabled" checked>
                                <label for="stage-timer-enabled">Activar timers en las etapas del juego</label>
                            </div>
                            <div class="timer-input-group" id="timer-duration-group">
                                <label for="night-duration">Duraci√≥n por etapa (segundos):</label>
                                <input type="number" id="night-duration" min="30" max="300" value="60" class="timer-input">
                            </div>
                            <div class="timer-description">
                                Si est√° activado, cada fase (brujas, alguacil, confesiones) tendr√° un tiempo l√≠mite. Si est√° desactivado, las etapas no tendr√°n l√≠mite de tiempo.
                            </div>
                        </div>
                        
                        <div class="voice-config">
                            <h4 class="config-subtitle">üîä Sistema de Voces</h4>
                            <div class="checkbox-group">
                                <input type="checkbox" id="voice-enabled" checked>
                                <label for="voice-enabled">Activar narraci√≥n por voz</label>
                            </div>
                            <div class="voice-controls" id="voice-controls-group">
                                <div class="volume-control">
                                    <label for="voice-volume">Volumen de voz:</label>
                                    <input type="range" id="voice-volume" min="0" max="100" value="70" class="volume-slider">
                                    <span id="volume-display">70%</span>
                                </div>
                                <div class="speed-control">
                                    <label for="voice-speed">Velocidad:</label>
                                    <select id="voice-speed" class="speed-select">
                                        <option value="0.8">Lenta</option>
                                        <option value="1" selected>Normal</option>
                                        <option value="1.2">R√°pida</option>
                                    </select>
                                </div>
                            </div>
                            <div class="voice-description">
                                La voz narrar√° las transiciones del juego: "Cierren los ojos", "Abran los ojos las brujas", etc. Compatible con navegadores y APK.
                            </div>
                            <div class="voice-test-section">
                                <button id="test-audio-btn" class="btn btn-test">
                                    üé§ Probar Audio
                                </button>
                            </div>
                        </div>
                        
                        <div class="music-config">
                            <h4 class="config-subtitle">üéµ M√∫sica de Fondo</h4>
                            <div class="checkbox-group">
                                <input type="checkbox" id="music-enabled" checked>
                                <label for="music-enabled">Activar m√∫sica de fondo</label>
                            </div>
                            <div class="music-controls" id="music-controls-group">
                                <div class="volume-control">
                                    <label for="music-volume">Volumen de m√∫sica:</label>
                                    <input type="range" id="music-volume" min="0" max="100" value="30" class="volume-slider">
                                    <span id="music-volume-display">30%</span>
                                </div>
                            </div>
                            <div class="music-description">
                                La m√∫sica de fondo crear√° ambiente durante las diferentes fases del juego. Se reproduce autom√°ticamente durante las partidas.
                            </div>
                        </div>
                        
                        <div class="auto-timer-config">
                            <h4 class="config-subtitle">üîÑ Transiciones Autom√°ticas</h4>
                            <div class="checkbox-group">
                                <input type="checkbox" id="auto-timer-enabled" checked>
                                <label for="auto-timer-enabled">Activar timers autom√°ticos de 5 segundos en transiciones</label>
                            </div>
                            <div class="auto-timer-description">
                                Si est√° activado, las pantallas de transici√≥n avanzar√°n autom√°ticamente despu√©s de 5 segundos. Si est√° desactivado, ser√° necesario presionar el bot√≥n para continuar.
                            </div>
                        </div>
                    </div>
                </div>

                <div class="controls-section">
                    <button id="start-game-btn" class="btn btn-start" disabled>
                        üåô Comenzar los Juicios
                    </button>
                </div>
            </div>
        </div>

        <!-- Fase del juego -->
        <div id="game-phase" class="game-phase">
            <div class="phase-container">
                <div id="phase-indicator" class="phase-indicator"></div>
                
                <div id="role-assignment" class="role-section">
                    <h2 class="phase-title">üé≠ Asignaci√≥n de Roles</h2>
                    <div id="roles-display" class="roles-display"></div>
                    <button id="continue-btn" class="btn btn-primary">Continuar</button>
                </div>

                <div id="sheriff-selection" class="sheriff-section" style="display: none;">
                    <h2 class="phase-title">‚öñÔ∏è Elecci√≥n del Sheriff</h2>
                    <p class="instruction">Los aldeanos deben elegir un Sheriff para liderar los juicios</p>
                    <div id="sheriff-candidates" class="candidates-grid"></div>
                    <button id="confirm-sheriff-btn" class="btn btn-primary" style="display: none;">
                        Confirmar Sheriff
                    </button>
                </div>

                <div id="confession-phase" class="confession-section" style="display: none;">
                    <h2 class="phase-title">üïØÔ∏è Fase de Confesi√≥n</h2>
                    <div id="confession-content" class="confession-content"></div>
                </div>

                <div id="results-phase" class="results-section" style="display: none;">
                    <h2 class="phase-title">‚ö±Ô∏è Resultados de la Noche</h2>
                    <div id="results-content" class="results-content"></div>
                    <div class="results-controls">
                        <button id="new-night-btn" class="btn btn-primary">üåô Nueva Noche</button>
                        <button id="end-game-btn" class="btn btn-secondary">üèÅ Terminar Juego</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controles globales -->
        <div class="global-controls">
            <button id="reset-game-btn" class="btn btn-reset">üîÑ Reiniciar</button>
            <div id="timer-display" class="timer-display" style="display: none;">
                <span id="timer-text">‚è∞ 00:00</span>
            </div>
        </div>

        <!-- Modal para inmunidad -->
        <div id="immunity-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h3>üõ°Ô∏è Inmunidad Activada</h3>
                <p id="immunity-message"></p>
                <button id="immunity-ok-btn" class="btn btn-primary">Entendido</button>
            </div>
        </div>
    </div>

    <script>
        // Solo cargar cordova.js si estamos en un entorno Cordova
        if (window.cordova || document.URL.indexOf('http://') === -1 && document.URL.indexOf('https://') === -1) {
            document.write('<script src="cordova.js"><\/script>');
        }
    </script>
    <script src="js/simple-background-music.js"></script>
    <script src="js/simple-web-speech.js"></script>
    <script src="script.js"></script>
    
    <script>
        // Registrar Service Worker para PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('‚úÖ Service Worker registrado exitosamente:', registration.scope);
                        
                        // Verificar si hay actualizaciones
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Nueva versi√≥n disponible
                                    console.log('üîÑ Nueva versi√≥n de la app disponible');
                                    if (confirm('¬°Nueva versi√≥n disponible! ¬øDeseas actualizar?')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.log('‚ùå Error al registrar Service Worker:', error);
                    });
            });
            
            // Escuchar cuando el Service Worker toma control
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                window.location.reload();
            });
        }
    </script>
</body>
</html>